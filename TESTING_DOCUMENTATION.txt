================================================================================
SITECRAFTER - COMPREHENSIVE SOFTWARE TESTING DOCUMENTATION
AI-Powered Website Builder Application
================================================================================

Date: December 20, 2024
Version: 1.0.0
Project Type: Full-Stack Web Application
Testing Approach: Black Box Testing + White Box Testing

================================================================================
SECTION 1: PROJECT OVERVIEW
================================================================================

1.1 APPLICATION DESCRIPTION
----------------------------
SiteCrafter is an AI-powered website builder that allows users to generate 
complete React/TypeScript web applications from natural language prompts.

Key Features:
- User Authentication (Email/Password + Google OAuth)
- AI-Powered Website Generation using LangGraph pipeline
- Planning phase with blueprint visualization
- Real-time code generation with preview
- Multi-page React application output

1.2 TECHNOLOGY STACK
--------------------
FRONTEND:
- Framework: React 18+ with TypeScript
- Routing: React Router DOM v6
- State Management: React Context API
- HTTP Client: Axios
- Styling: Tailwind CSS
- Build Tool: Vite

BACKEND:
- Runtime: Node.js with Express.js
- Language: TypeScript
- Database: MongoDB with Mongoose ODM
- Authentication: Passport.js (Local + Google OAuth2)
- AI Integration: Google Gemini API via LangChain
- Session Management: express-session

EXTERNAL SERVICES:
- Google OAuth 2.0 for social login
- Google Gemini AI for code generation
- Mem0 API for persistent memory between LLM calls
- MongoDB Atlas for database hosting

================================================================================
SECTION 2: SYSTEM ARCHITECTURE
================================================================================

2.1 FRONTEND ARCHITECTURE
--------------------------
Root Component: App.tsx
├── Router (BrowserRouter)
│   └── AuthProvider (Context)
│       ├── Public Routes
│       │   ├── / (Home)
│       │   ├── /login (Login)
│       │   └── /signup (Register)
│       │
│       └── Protected Routes (ProtectedRoute wrapper)
│           ├── /dashboard (ProjectTypeSelection)
│           ├── /select (ProjectTypeSelection)
│           ├── /planning (Planning)
│           └── /builder (Builder)

Key Components:
- AuthContext.tsx: Manages authentication state
- ProtectedRoute.tsx: Route guard for authenticated routes
- Builder.tsx: Main code generation interface
- Planning.tsx: Blueprint visualization

2.2 BACKEND ARCHITECTURE
-------------------------
Entry Point: index.ts
├── Express Application
│   ├── Middleware
│   │   ├── CORS
│   │   ├── JSON Parser
│   │   ├── Session Management
│   │   └── Passport Initialization
│   │
│   ├── Routes
│   │   ├── /auth (auth.ts)
│   │   │   ├── POST /signup
│   │   │   └── POST /login  
│   │   │
│   │   ├── /auth (googleAuth.ts)
│   │   │   ├── GET /google
│   │   │   ├── GET /google/callback
│   │   │   └── GET /check-session
│   │   │
│   │   ├── POST /template
│   │   ├── POST /planning
│   │   ├── POST /chat
│   │   ├── POST /chat/agentic
│   │   └── POST /chat/langgraph (Main generation endpoint)
│   │
│   └── Services
│       ├── PlanningService (planning-fixed.service.ts)
│       ├── UIService (ui.service.ts)
│       └── LangGraph Agent Pipeline
│           ├── blueprint-node.ts
│           ├── core-node.ts
│           ├── component-node.ts
│           ├── page-node.ts
│           └── repair-node.ts

================================================================================
SECTION 3: AUTHENTICATION SYSTEM
================================================================================

3.1 AUTHENTICATION METHODS
---------------------------
1. Email/Password Authentication (Local Strategy)
2. Google OAuth 2.0 Authentication

3.2 GOOGLE OAUTH FLOW
----------------------
Step 1: User clicks "Sign in with Google"
Step 2: Frontend redirects to: GET /auth/google
Step 3: Passport initiates Google OAuth with scopes: ['profile', 'email']
Step 4: User authenticates on Google's consent screen
Step 5: Google redirects to: GET /auth/google/callback
Step 6: Passport validates OAuth response
Step 7: Backend creates/finds user in MongoDB
Step 8: Backend generates JWT token (7 days expiry)
Step 9: Backend redirects to frontend: /dashboard?token={jwt}&user={userObj}
Step 10: Frontend extracts token from URL and stores in localStorage
Step 11: AuthContext updates state with user info
Step 12: User is now authenticated and redirected to dashboard

3.3 LOCAL AUTH FLOW
--------------------
SIGNUP:
1. User submits: email, username, password
2. Backend validates no duplicate email/username exists
3. Password is hashed using bcrypt (in User model pre-save hook)
4. User document created in MongoDB
5. JWT token generated (24h expiry)
6. Response: { token, user: { id, email, username } }

LOGIN:
1. User submits: email, password
2. Backend finds user by email
3. If user has no password (OAuth user), special error returned
4. Password compared using bcrypt
5. JWT token generated (24h expiry)
6. Response: { token, user: { id, email, username } }

3.4 TOKEN MANAGEMENT
---------------------
- JWT tokens stored in localStorage
- Token attached to all API requests via Axios interceptor
- AuthContext checks localStorage on app initialization
- Logout clears localStorage and removes Authorization header

================================================================================
SECTION 4: BLACK BOX TESTING
================================================================================

4.1 AUTHENTICATION MODULE TEST CASES
--------------------------------------

TC-AUTH-001: Google OAuth Login - Happy Path
---------------------------------------------
Description: Test successful Google OAuth authentication
Preconditions: User has valid Google account
Test Steps:
1. Navigate to /login page
2. Click "Sign in with Google" button
3. Complete Google authentication
4. Verify redirect to /dashboard
5. Verify user info displayed correctly
Expected Result: User successfully logged in, JWT token stored
Status: [TO BE TESTED]

TC-AUTH-002: Google OAuth Login - Cancelled
--------------------------------------------
Description: Test Google OAuth when user cancels
Preconditions: User has valid Google account
Test Steps:
1. Navigate to /login page
2. Click "Sign in with Google" button
3. Cancel on Google consent screen
4. Verify redirect to /login with error parameter
Expected Result: User redirected to login with auth_failed error
Status: [TO BE TESTED]

TC-AUTH-003: Email/Password Signup - Valid Data
------------------------------------------------
Description: Test successful email/password signup
Preconditions: Email not already registered
Test Data: 
  email: "test@example.com"
  username: "testuser"
  password: "SecurePass123"
Test Steps:
1. Navigate to /signup page
2. Enter valid email, username, password
3. Submit form
4. Verify redirect to dashboard
Expected Result: Account created, JWT token stored, user logged in
Status: [TO BE TESTED]

TC-AUTH-004: Email/Password Signup - Duplicate Email
-----------------------------------------------------
Description: Test signup with existing email
Preconditions: Email already registered
Test Steps:
1. Navigate to /signup page
2. Enter existing email
3. Submit form
Expected Result: Error message "Email or username already exists"
Status: [TO BE TESTED]

TC-AUTH-005: Email/Password Login - Valid Credentials
------------------------------------------------------
Description: Test successful email/password login
Preconditions: User account exists with password
Test Steps:
1. Navigate to /login page
2. Enter valid email and password
3. Submit form
Expected Result: User logged in, redirected to dashboard
Status: [TO BE TESTED]

TC-AUTH-006: Email/Password Login - Invalid Password
-----------------------------------------------------
Description: Test login with wrong password
Test Steps:
1. Navigate to /login page
2. Enter valid email with wrong password
3. Submit form
Expected Result: Error message "Invalid credentials"
Status: [TO BE TESTED]

TC-AUTH-007: OAuth User Tries Password Login
---------------------------------------------
Description: Test password login for OAuth-only account
Preconditions: User registered only via Google OAuth
Test Steps:
1. Navigate to /login page
2. Enter OAuth user's email with any password
3. Submit form
Expected Result: Error "This account is registered via OAuth. Please sign in with Google or Microsoft."
Status: [TO BE TESTED]

TC-AUTH-008: Protected Route - Unauthenticated Access
-------------------------------------------------------
Description: Test accessing protected route without login
Preconditions: User not logged in
Test Steps:
1. Clear localStorage
2. Navigate directly to /dashboard
Expected Result: Redirect to /login page
Status: [TO BE TESTED]

TC-AUTH-009: Protected Route - Authenticated Access
-----------------------------------------------------
Description: Test accessing protected route when logged in
Preconditions: Valid JWT token in localStorage
Test Steps:
1. Login successfully
2. Navigate to /dashboard
Expected Result: Dashboard page renders correctly
Status: [TO BE TESTED]

TC-AUTH-010: Logout Functionality
----------------------------------
Description: Test logout clears session
Test Steps:
1. Login successfully
2. Click logout button
3. Verify redirect to /login
4. Check localStorage cleared
5. Try accessing /dashboard
Expected Result: User logged out, cannot access protected routes
Status: [TO BE TESTED]

4.2 WEBSITE GENERATION MODULE TEST CASES
-----------------------------------------

TC-GEN-001: Basic Website Generation
-------------------------------------
Description: Test generating a simple website
Test Data: Prompt = "Create a portfolio website"
Test Steps:
1. Login to application
2. Navigate to /select
3. Choose "Frontend" project type
4. Enter prompt
5. Click generate
Expected Result: Website code generated with multiple files
Status: [TO BE TESTED]

TC-GEN-002: Generation with Complex Requirements
-------------------------------------------------
Description: Test with detailed multi-page requirements
Test Data: Prompt = "Create a restaurant website with menu, about, and contact pages"
Test Steps:
1. Login and navigate to builder
2. Enter complex prompt
3. Submit generation request
Expected Result: Multi-page React application generated
Status: [TO BE TESTED]

TC-GEN-003: Empty Prompt Handling
----------------------------------
Description: Test submitting empty prompt
Test Steps:
1. Navigate to builder
2. Submit with empty prompt
Expected Result: Error message "Prompt is required"
Status: [TO BE TESTED]

4.3 PLANNING MODULE TEST CASES
-------------------------------

TC-PLAN-001: Blueprint Generation
----------------------------------
Description: Test planning phase generates blueprint
Test Data: Requirements = "E-commerce website"
Test Steps:
1. Navigate to /planning
2. Submit requirements
3. Verify blueprint visualization
Expected Result: Interactive node graph displayed
Status: [TO BE TESTED]

================================================================================
SECTION 5: WHITE BOX TESTING
================================================================================

5.1 AUTHENTICATION CODE ANALYSIS
---------------------------------

FILE: backend/src/routes/auth.ts

FUNCTION: POST /signup
-------------------------
Code Path Analysis:
1. Extract { email, username, password } from req.body
2. Query MongoDB for existing user with same email OR username
3. BRANCH: If existingUser found
   └─ Return 400: "Email or username already exists"
4. Create new User document (password auto-hashed by model)
5. BRANCH: If JWT_SECRET not defined
   └─ Return 500: "Internal server error"
6. Generate JWT with userId and username, 24h expiry
7. Return 201: { message, token, user }
8. EXCEPTION: Catch any error → Return 500: "Server error"

Coverage Points:
- Line 20-66: Signup route handler
- Branch at line 28: Existing user check
- Branch at line 39: JWT_SECRET validation
- Error handling at line 62-65

Unit Test Cases:
- UT-AUTH-001: Test with valid new user data
- UT-AUTH-002: Test with duplicate email
- UT-AUTH-003: Test with duplicate username  
- UT-AUTH-004: Test with missing JWT_SECRET env var
- UT-AUTH-005: Test with MongoDB connection failure

FUNCTION: POST /login
----------------------
Code Path Analysis:
1. Extract { email, password } from req.body
2. Query MongoDB for user by email
3. BRANCH: If user not found
   └─ Return 401: "Invalid credentials"
4. BRANCH: If user.password is null/undefined (OAuth user)
   └─ Return 401: "This account is registered via OAuth..."
5. Compare password using bcrypt (user.comparePassword)
6. BRANCH: If password doesn't match
   └─ Return 401: "Invalid credentials"
7. BRANCH: If JWT_SECRET not defined
   └─ Return 500: "Internal server error"
8. Generate JWT token with 24h expiry
9. Return 200: { token, user }
10. EXCEPTION: Catch any error → Return 500: "Server error"

Coverage Points:
- Line 68-116: Login route handler
- Branch at line 74: User not found
- Branch at line 79: OAuth user check
- Branch at line 85: Password mismatch
- Branch at line 90: JWT_SECRET validation

5.2 GOOGLE OAUTH CODE ANALYSIS
-------------------------------

FILE: backend/src/routes/googleAuth.ts

FUNCTION: GET /google
----------------------
Initiates Google OAuth flow via Passport.js
Scopes requested: ['profile', 'email']

FUNCTION: GET /google/callback
--------------------------------
Code Path Analysis:
1. Passport authenticates with Google response
2. BRANCH: If authentication fails
   └─ Redirect to /login with failureRedirect
3. Extract user from req.user
4. BRANCH: If user is null
   └─ Redirect to frontend/login?error=auth_failed
5. Generate JWT token with generateToken() function
6. Encode user object as URI component
7. Construct redirect URL (handle trailing slash)
8. Redirect to: {frontend}/dashboard?token={jwt}&user={userObj}
9. EXCEPTION: Catch any error
   └─ Redirect to frontend/login?error=server_error

FUNCTION: generateToken(user)
------------------------------
Code Path Analysis:
1. BRANCH: If JWT_SECRET not defined
   └─ Throw Error
2. Sign JWT with { userId, email, username }
3. Set expiry to 7 days
4. Return signed token

Coverage Points:
- Line 10-24: Token generation
- Line 26-27: Google auth initiation
- Line 30-60: Callback handler
- Line 63-89: Session check endpoint

5.3 FRONTEND AUTH CONTEXT ANALYSIS
-----------------------------------

FILE: frontend/src/components/context/AuthContext.tsx

FUNCTION: AuthProvider Component
---------------------------------
State Variables:
- user: User | null
- token: string | null
- loading: boolean

useEffect - initAuth():
1. Read storedToken from localStorage
2. Read storedUser from localStorage
3. BRANCH: If both exist
   └─ Parse user JSON
   └─ Set token and user state
   └─ Set Axios Authorization header
4. EXCEPTION: If JSON parse fails
   └─ Clear localStorage
5. Set loading = false

FUNCTION: login(userData, authToken)
-------------------------------------
1. Store token in localStorage
2. Store user JSON in localStorage
3. Set Axios Authorization header
4. Update state: user, token
5. Navigate to /dashboard
6. EXCEPTION: Throw error if any step fails

FUNCTION: logout()
-------------------
1. Remove token from localStorage
2. Remove user from localStorage
3. Delete Axios Authorization header
4. Set state: user = null, token = null
5. Navigate to /login

5.4 LANGGRAPH PIPELINE ANALYSIS
--------------------------------

FILE: backend/src/agents/langgraph/

Node Execution Order:
1. blueprint-node.ts → Generates project blueprint JSON
2. core-node.ts → Generates main.tsx, App.tsx, layout components
3. component-node.ts → Generates UI and feature components
4. page-node.ts → Generates page components
5. repair-node.ts → Fixes any validation errors

State Management:
- WebsiteState contains: blueprint, files, fileRegistry, projectId, messages
- Each node reads state, performs generation, returns partial state update
- Mem0 API used for persistent memory between LLM calls

================================================================================
SECTION 6: GENERATED TEST PROJECTS
================================================================================

11 Test Projects Generated and Tested:

1. test1 - Basic website (34 files)
2. test2 - Website with components (44 files)  
3. test3 - Complex multi-page site (78 files)
4. test4 - E-commerce style (74 files)
5. test5 - Simple portfolio (38 files)
6. test6 - Landing page (36 files)
7. test7 - Dashboard application (42 files)
8. test8 - Educational platform (46 files)
9. test9 - Business website (44 files)
10. test10 - Karnataka Education Nexus (40 files)
11. test11 - Taalvista Tabla Academy (45 files)

Common Generated Structure:
- src/main.tsx (Entry point with BrowserRouter)
- src/App.tsx (Route definitions)
- src/components/layout/ (Header, Footer, AppLayout)
- src/components/ui/ (Button, Card, Input, Modal, etc.)
- src/components/features/ (Domain-specific components)
- src/pages/ (Page components)
- src/lib/utils.ts (Utility functions)
- index.html, tailwind.config.js, vite.config.ts

================================================================================
SECTION 7: API ENDPOINTS REFERENCE
================================================================================

AUTHENTICATION ENDPOINTS:

POST /auth/signup
-----------------
Request: { email, username, password }
Response: { message, token, user: { id, email, username } }
Errors: 400 (duplicate), 500 (server error)

POST /auth/login
----------------
Request: { email, password }
Response: { token, user: { id, email, username } }
Errors: 401 (invalid credentials, OAuth user), 500 (server error)

GET /auth/google
----------------
Initiates Google OAuth flow
Redirects to Google consent screen

GET /auth/google/callback
-------------------------
Handles OAuth callback from Google
Redirects to: /dashboard?token={jwt}&user={encoded_user}
Errors: Redirect to /login?error=auth_failed

GET /auth/check-session
-----------------------
Response: { token, user: { id, email, username } }
Errors: 401 (no session), 500 (server error)

GENERATION ENDPOINTS:

POST /template
--------------
Request: { prompt, projectType }
Response: { prompts, uiPrompts }

POST /planning
--------------
Request: { requirements, projectType }
Response: { success, data: blueprint }

POST /chat
----------
Request: { messages: [{ role, content }] }
Response: Streaming text response

POST /chat/langgraph
--------------------
Request: { prompt, projectType }
Response: { 
  success, 
  response: XML artifact string,
  stats: { filesGenerated, blueprint }
}

================================================================================
SECTION 8: DATABASE SCHEMA
================================================================================

USER COLLECTION (MongoDB)
--------------------------
{
  _id: ObjectId,
  email: String (unique, required),
  username: String (unique, required),
  password: String (optional - hashed with bcrypt),
  googleId: String (optional, sparse unique index),
  createdAt: Date,
  updatedAt: Date
}

Indexes:
- email: unique
- username: unique
- googleId: sparse unique

Methods:
- comparePassword(candidatePassword): Promise<boolean>
  Uses bcrypt.compare() to verify password

Pre-save Hook:
- If password modified, hash with bcrypt (salt rounds: 10)

================================================================================
SECTION 9: SECURITY CONSIDERATIONS
================================================================================

9.1 AUTHENTICATION SECURITY
-----------------------------
- Passwords hashed with bcrypt (10 rounds)
- JWT tokens with expiration (24h local, 7d OAuth)
- OAuth state verification via Passport.js
- Session-based authentication for OAuth flow

9.2 POTENTIAL VULNERABILITIES TO TEST
---------------------------------------
- SQL/NoSQL Injection in login fields
- XSS in user-submitted prompts
- CSRF protection on state-changing endpoints
- Rate limiting on auth endpoints
- Token storage security (localStorage vs httpOnly cookies)
- OAuth redirect URI validation

================================================================================
SECTION 10: ENVIRONMENT VARIABLES
================================================================================

Required Environment Variables:

# Database
MONGODB_URI=mongodb+srv://...

# JWT
JWT_SECRET=your-secret-key

# Google OAuth
GOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=xxx

# Gemini AI (Multiple keys for rotation)
gemini=API_KEY_1
gemini2=API_KEY_2
gemini3=API_KEY_3
gemini4=API_KEY_4

# Mem0 Memory API
mem0=MEM0_API_KEY

# Frontend URLs
FRONTEND_URL=http://localhost:5173

================================================================================
SECTION 11: TEST EXECUTION SUMMARY
================================================================================

Test Categories:
1. Authentication Tests: 10 test cases
2. Generation Tests: 3 test cases
3. Planning Tests: 1 test case
4. White Box Unit Tests: 15+ coverage points

Total Black Box Test Cases: 14
Total White Box Analysis Points: 20+
Total Test Projects Generated: 11

================================================================================
END OF DOCUMENT
================================================================================
